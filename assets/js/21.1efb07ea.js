(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{397:function(e,t,a){"use strict";a.r(t);var s=a(46),i=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("!!!")]),e._v(" "),a("p",[e._v("This document has "),a("strong",[e._v("moved")]),e._v(".")]),e._v(" "),a("p",[e._v("You'll now find information like this in the "),a("a",{attrs:{href:"https://github.com/ipld/ipld/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ipld/ipld"),a("OutboundLink")],1),e._v(" meta-repo,\nand published to the web at https://ipld.io/ .")]),e._v(" "),a("p",[e._v("All documentation, fixtures, specifications, and web content is now gathered into that repo.\nPlease update your links, and direct new contributions there.")]),e._v(" "),a("p",[e._v("!!!")]),e._v(" "),a("hr"),e._v(" "),a("h1",{attrs:{id:"how-ipfs-web-gateways-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-ipfs-web-gateways-work"}},[e._v("#")]),e._v(" How IPFS Web Gateways Work")]),e._v(" "),a("p",[e._v("This document talks through how IPFS web gateways work;\nthe various forms of abstraction used in accomplishing parts of that task;\nand how and why these designs are cool (and how to can reuse parts of them).")]),e._v(" "),a("blockquote",[a("p",[e._v("üçµ\nNote!  This is an "),a("em",[e._v("aspirational")]),e._v(" document -- IPFS web gateways are a feature\nwhich has substantial history.  They haven't always worked like this.")])]),e._v(" "),a("h2",{attrs:{id:"what-are-the-goals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-are-the-goals"}},[e._v("#")]),e._v(" What are the goals?")]),e._v(" "),a("h3",{attrs:{id:"what-are-ipfs-web-gateways-anyway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-are-ipfs-web-gateways-anyway"}},[e._v("#")]),e._v(" What are IPFS Web Gateways, anyway?")]),e._v(" "),a("p",[e._v('The "web gateway" is a feature of IPFS that serves the contents of '),a("em",[e._v("files")]),e._v(" over "),a("em",[e._v("HTTP")]),e._v(".\nIt selects what content to serve by taking the path from the URL requested,\nand splitting it into two parts: the "),a("em",[e._v("CID")]),e._v(" and the remainder of the "),a("em",[e._v("path")]),e._v(".")]),e._v(" "),a("p",[e._v("The CID is used to pick some piece of data to start at.\nThe remainder of the path will be used as instructions to traverse IPLD data,\nstarting from that data which the CID identified.\nAt the end of that traversal, we'll try to understand whatever is pointed to as\na bunch of bytes (a \"file\" isn't much more than that)... and pour it out into an HTTP response.")]),e._v(" "),a("p",[e._v("This is useful because it means we can store data in IPFS,\nand that data can become easily accessible as normal webpages.")]),e._v(" "),a("h2",{attrs:{id:"how-do-we-do-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-do-we-do-it"}},[e._v("#")]),e._v(" How do we do it?")]),e._v(" "),a("p",[e._v("There's actually a ton of moving parts to this.\nLet's break it down:")]),e._v(" "),a("h3",{attrs:{id:"files-are-just-bytes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#files-are-just-bytes"}},[e._v("#")]),e._v(" files are just bytes")]),e._v(" "),a("p",[e._v("(... in this context, anyway.)")]),e._v(" "),a("p",[e._v("TODO expound")]),e._v(" "),a("h3",{attrs:{id:"large-bytes-are-provided-by-adls-fbl-specifically"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#large-bytes-are-provided-by-adls-fbl-specifically"}},[e._v("#")]),e._v(" large bytes are provided by ADLs (FBL, specifically)")]),e._v(" "),a("p",[e._v("TODO expound")]),e._v(" "),a("h3",{attrs:{id:"directories-are-provided-by-adls-hamt-specifically"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#directories-are-provided-by-adls-hamt-specifically"}},[e._v("#")]),e._v(" directories are provided by ADLs (HAMT, specifically)")]),e._v(" "),a("p",[e._v("TODO expound")]),e._v(" "),a("h3",{attrs:{id:"navigating-the-path-is-defined-by-the-data-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#navigating-the-path-is-defined-by-the-data-model"}},[e._v("#")]),e._v(" navigating the path is defined by the Data Model")]),e._v(" "),a("p",[e._v("... which is neat, because most of it is also going through ADLs,\nas we just described in the previous sections.")]),e._v(" "),a("p",[e._v("Because defining an ADL requires defining how the ADL will make its\ncontent data legible to regular IPLD Data Model semantics,\nwe can use standard library functions for pathing over this data.\nNo special path handling logic is written for the Web Gateways\n(or other users of unixfsv2) at all!")]),e._v(" "),a("h3",{attrs:{id:"knowing-where-to-use-adls-and-which-ones-is-defined-by-ipld-schemas"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#knowing-where-to-use-adls-and-which-ones-is-defined-by-ipld-schemas"}},[e._v("#")]),e._v(" knowing where to use ADLs, and which ones, is defined by IPLD Schemas")]),e._v(" "),a("p",[e._v("... and more specifically, the Unixfsv2 schema,\nwhich is pretty common and used by much more than the IPFS web gateway system.")]),e._v(" "),a("p",[e._v("The web gateways know about the schema for unixfsv2,\nand they assume that it applies to whatever data is being requested through the gateway system.")]),e._v(" "),a("p",[e._v("If the data doesn't match, it won't be renderable through the web gateway\n(and we return errors about how and where the data ceased to match the\nschema that's expected for unixfsv2 data).")]),e._v(" "),a("p",[e._v("If the data does match: then the schema also tells us where to expect ADLs\nto come into effect, and also tells us what Data Model semantics to expect\nfrom the data that is made available once the ADL logic is applied.")]),e._v(" "),a("h3",{attrs:{id:"if-you-don-t-have-this-data-we-fetch-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#if-you-don-t-have-this-data-we-fetch-it"}},[e._v("#")]),e._v(" if you don't have this data: we fetch it")]),e._v(" "),a("p",[e._v("This part hits the limits of what is directly in the scope of IPLD,\nbut in brief, what happens in IPFS is:")]),e._v(" "),a("ul",[a("li",[e._v("a request for info about anyone who might have the missing content will be made to the DHT (provided by libp2p)")]),e._v(" "),a("li",[e._v("contact with those other IPFS nodes will be made (again brokered by libp2p, which might be handling NAT traversal, etc)")]),e._v(" "),a("li",[e._v("a protocol like bitswap or graphsync will be used to ferry raw blocks of IPLD data from those other IPFS nodes")]),e._v(" "),a("li",[e._v("... and then the data is local: the process picks up again normally from there.")])]),e._v(" "),a("h2",{attrs:{id:"what-if-we-want-to-peek-behind-the-curtain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-if-we-want-to-peek-behind-the-curtain"}},[e._v("#")]),e._v(" What if we want to peek behind the curtain?")]),e._v(" "),a("p",[e._v("All of the structures above are serialized in CBOR.\nAll the magic comes from IPLD semantic features like ADLs and Schemas.")]),e._v(" "),a("p",[e._v("What's neat about this is it's also very easy to drop all the magic\nand look directly at the raw data.")]),e._v(" "),a("p",[e._v("Want to see the raw CBOR objects that make up all these structures?  No problem.\nThey're hidden just barely under the hood, and we try to make it easy to lift that hood\nup and take a peek.")]),e._v(" "),a("p",[e._v('In fact, you can inspect all the raw CBOR objects making up these structures\nsimply by using IPLD libraries to start at the same CID,\nand then use regular Data Model traversal mechanisms to stroll around.\nIf you provide the Unixfsv2 schema (and thereby its hints about where to apply ADLs),\nyou\'ll get the high level view of "directories" (maps) and "files" (bytes);\nif you don\'t, you\'ll get to stroll around the raw CBOR objects instead.')]),e._v(" "),a("h2",{attrs:{id:"what-s-reusable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-s-reusable"}},[e._v("#")]),e._v(" What's reusable?")]),e._v(" "),a("p",[e._v("Gosh.  Dang near everything.")]),e._v(" "),a("ul",[a("li",[e._v("The Unixfsv2 schema is reusable.  If you want to describe filesystem-like data, it's probably got what you want.")]),e._v(" "),a("li",[e._v("The Flexible Byte Layout (FBL) Advanced Data Layout is reusable for any of your big-sharded-byte-sequence needs!\nIt's not unique to Unixfsv2 nor the IPFS web gateways; you can drop it in anywhere you want in any IPLD system.")]),e._v(" "),a("li",[e._v("The HAMT ADL is similarly reusable for any of your big-sharded-map needs!\nIt's not unique to Unixfsv2 nor the IPFS web gateways; you can drop it in anywhere you want in any IPLD system.")]),e._v(" "),a("li",[e._v("... even if you don't want any of these things in particular, hopefully this is\na good example of how you can use the various parts of the IPLD system to accomplish your own goals!")])]),e._v(" "),a("p",[e._v("The whole IPFS web gateway system was built in terms of standard IPLD components, assembled:\nschemas, ADLs, and plain basic pathing and traversal over the Data Model were all we needed to accomplish all this.")]),e._v(" "),a("h2",{attrs:{id:"what-other-limits-does-this-have"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-other-limits-does-this-have"}},[e._v("#")]),e._v(" What other limits does this have?")]),e._v(" "),a("p",[e._v("It's important to note that the web gateways do almost all of this work\nusing IPLD libraries and not much else... but, ADLs also have some special caveats.")]),e._v(" "),a("p",[e._v("Because ADLs need some logic to make their translations of data work,\nand because IPLD doesn't itself include an interpreter or scripting language runtime\n(and even if it did, we'd be worried about capping its resource budget)...\nIPLD libraries typically require that a list of allowed ADLs be defined explicitly.")]),e._v(" "),a("p",[e._v("The IPFS web gateways specifically allow the FBL and HAMT ADLs.")]),e._v(" "),a("p",[e._v("If you wanted to produce data that used other sharding algorithms,\nbut was otherwise structurally matching the Unixfsv2 schema,\nand wanted those to be correctly displayed by some IPFS web gateway?\nYou'd need to reconfigure that gateway to expand the list of allowed ADLs\nto include whatever sharding system it is your wanted to use.")]),e._v(" "),a("h2",{attrs:{id:"historically-how-did-this-previously-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#historically-how-did-this-previously-work"}},[e._v("#")]),e._v(" Historically: how did this previously work?")]),e._v(" "),a("blockquote",[a("p",[e._v("üìï\nThis section is historical notes -- it's here for readers who were familiar\nwith the old system, and want to be refreshed on how it compares to the new\ndesigns documented above, or for readers who want to understand some of the\nlearning experiences gathered from previous bouts at this work.\nHowever, you shouldn't really need to read it unless one of those two\nsources of curiosity appeals to you.")])]),e._v(" "),a("p",[e._v('The earliest implementations of IPFS used a codec called "dag-pb" to represent files and directories.\n("dag-pb" is still around as an IPLD codec -- but nowadays, we consider it one of the more limited codecs, and a very esoteric one at that.)')]),e._v(" "),a("p",[e._v('The "dag-pb" codec included many responsibilities that we now handle separately:\nit included the concept of directories (and sharding them) in the codec itself (whereas we now split this out into map ADLs);\nsimilarly, it include the concept of files (and sharding their component bytes) in the codec itself (whereas we now split this out into bytes ADLs).')]),e._v(" "),a("p",[e._v("By baking these things into the codec itself, there were several major disadvantages compared to the present IPLD system design:")]),e._v(" "),a("ul",[a("li",[e._v("by baking these sharding mechanisms into a single codec, it was not possible to reuse them with other codecs;")]),e._v(" "),a("li",[e._v("because the sharding mechanisms were baked in the codec (and at the time,\nthere wasn't really any coherent definiton of a Data Model at all),\nthere was no way to "),a("em",[e._v("switch")]),e._v(" between high level and raw views of the data --\nas a result, these systems were much harder to debug;")]),e._v(" "),a("li",[e._v("because the sharding mechanisms were tightly bound into the codec,\nthere was no way to introduce or even experiment with other sharding mechanisms!")])]),e._v(" "),a("p",[e._v('Looking at the other direction, "dag-pb", even with all its special features, was more limited than the modern IPLD system designs:')]),e._v(" "),a("ul",[a("li",[e._v("by extracting the concept of ADLs, we've made it possible to shard other datastructures as well --\nfor example, we can now easily support sharded lists, a concept which simply didn't exist in dag-pb.")]),e._v(" "),a("li",[e._v("dag-pb had very (very) rigid ideas about the topology of data.\nIn modern terms, we would say it doesn't support the complete IPLD Data Model.\nThe huge behavioral gaps and asymmetry in representability between dag-pb and\nother early IPLD codecs produced a great deal of confusion.")])])])}),[],!1,null,null,null);t.default=i.exports}}]);